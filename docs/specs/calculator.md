# Спецификация калькулятора прибыли ProKaspi

## 1. Входные данные

| Поле | Тип | Описание | Обязательность |
|------|-----|----------|----------------|
| Цена продажи на Kaspi | число (₸) | Цена товара на витрине | обязательно, > 0 |
| Комиссия Kaspi | число (%) | Процент комиссии площадки | обязательно, 0–100 |
| Город доставки | перечисление | Тип доставки | обязательно |
| Диапазон цены | перечисление | Для цен до 10 000 ₸ | при цене ≤ 10 000 |
| Вес товара | перечисление | Для цен свыше 10 000 ₸ | при цене > 10 000 |
| Упаковка | число (₸) | Стоимость упаковки | обязательно, ≥ 0 |
| Себестоимость товара | число (₸) | Затраты на товар | обязательно, ≥ 0 |

### 1.1. Город доставки (тип доставки)

- `kz` — Казахстан (межгород)
- `express` — Express (внутри города)

### 1.2. Диапазон цены (при цене до 10 000 ₸)

- `0_1000` — до 1 000 ₸
- `1000_3000` — 1 000 – 3 000 ₸
- `3000_5000` — 3 000 – 5 000 ₸
- `5000_10000` — 5 000 – 10 000 ₸

### 1.3. Вес товара (при цене свыше 10 000 ₸)

- `0_5` — до 5 кг
- `5_15` — 5 – 15 кг
- `15_30` — 15 – 30 кг
- `30_60` — 30 – 60 кг
- `60_100` — 60 – 100 кг
- `100_plus` — свыше 100 кг

---

## 2. Формулы

### 2.1. Комиссия площадки

```
commissionAmount = round(price * (commissionPercent / 100), 2)
```

Комиссия считается от цены продажи. Округление до 2 знаков после запятой.

### 2.2. Доставка

Стоимость доставки зависит от:

1. **Цена ≤ 10 000 ₸** — используется поле «Диапазон цены» и тип доставки (Казахстан / Express). Значение берётся из таблицы тарифов по диапазону и типу.
2. **Цена > 10 000 ₸** — используется поле «Вес товара» и тип доставки. Значение берётся из таблицы тарифов по весу и типу.

Таблицы тарифов (константы) задаются в коде и при необходимости обновляются по данным Kaspi.

**Пример структуры тарифов (значения — ориентировочные, уточнить по Kaspi):**

- До 10 000 ₸: для каждого диапазона и типа доставки — фиксированная сумма (₸).
- Свыше 10 000 ₸: для каждой весовой категории и типа доставки — фиксированная сумма (₸).

Если данные не выбраны (например, цена > 10 000, но вес не выбран), доставка = 0 или расчёт не выполняется (валидация).

### 2.3. Прибыль

```
profit = price - commissionAmount - deliveryAmount - packaging - costPrice
```

Все величины в тенге. Округление результата до 2 знаков после запятой.

- `price` — цена продажи
- `commissionAmount` — комиссия площадки
- `deliveryAmount` — стоимость доставки (из тарифов)
- `packaging` — упаковка
- `costPrice` — себестоимость

---

## 3. Валидация и границы

### 3.1. Числовые поля

- **Цена продажи**: число, строго больше 0. Максимум не ограничен (или ограничить разумным, например 99 999 999).
- **Комиссия Kaspi**: число от 0 до 100 (включительно). Допускаются дробные (например, 12.5).
- **Упаковка**: число ≥ 0.
- **Себестоимость**: число ≥ 0.

### 3.2. Условные поля

- Если **цена ≤ 10 000**: должен быть выбран «Диапазон цены». Иначе расчёт доставки невозможен — считать доставку 0 или возвращать ошибку валидации.
- Если **цена > 10 000**: должен быть выбран «Вес товара». Иначе — аналогично.

### 3.3. Поведение при невалидном вводе

- Пустые обязательные поля → не считать, показать ошибки.
- Отрицательная цена / отрицательная комиссия (или &lt; 0 / &gt; 100) → ошибка валидации.
- Нечисловой ввод в числовых полях → ошибка или приведение к 0 с предупреждением (на усмотрение реализации: лучше явная ошибка).

---

## 4. Граничные случаи

| Случай | Ожидаемое поведение |
|--------|----------------------|
| Цена = 0 | Ошибка валидации, расчёт не выполняется |
| Цена &lt; 0 | Ошибка валидации |
| Комиссия = 0 | Допустимо, commissionAmount = 0 |
| Комиссия = 100 | Допустимо, commissionAmount = price |
| Упаковка = 0, себестоимость = 0 | Допустимо |
| Цена = 10 000 | Относится к диапазону «до 10 000» (диапазон 5000_10000) |
| Цена = 10 000.01 | Относится к «свыше 10 000», нужен выбор веса |
| Не выбран диапазон при цене ≤ 10 000 | Доставка = 0 или ошибка валидации (реализация: доставка 0 для упрощения) |
| Не выбран вес при цене > 10 000 | Доставка = 0 или ошибка валидации (реализация: доставка 0) |
| Прибыль &lt; 0 | Допустимо, показываем отрицательную прибыль (убыток) |

---

## 5. Выходные данные (результат расчёта)

- **commissionAmount** (₸) — комиссия площадки
- **deliveryAmount** (₸) — доставка
- **packaging** (₸) — упаковка (эхо ввода)
- **costPrice** (₸) — себестоимость (эхо ввода)
- **profit** (₸) — прибыль (может быть отрицательной)
- **totalDeductions** (₸) — сумма всех списаний: commissionAmount + deliveryAmount + packaging (опционально для отображения)

---

## 6. Источник тарифов

Актуальные тарифы доставки и комиссий — на [online.prokaspi.kz/calculator](https://online.prokaspi.kz/calculator) и в [Kaspi Гид для партнёров](https://guide.kaspi.kz/partner/ru/shop/). Константы в коде обновлять при изменении тарифов Kaspi.
